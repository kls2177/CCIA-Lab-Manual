# Preparing your Environment {#enviro}

_Last update: `r system("git log -1 --format=\"%ad (%h)\" -- 02-environment.Rmd", intern = TRUE)`_

During the labs in this manual, we will make use of a number of different pieces of software. Chiefly among these is Python. We will take for granted that you have already installed Python on your computer, but if you have not, please follow the [instructions to install Anaconda](https://docs.anaconda.com/anaconda/install/) on your operating system. We recommend using Anaconda3. If you already have Anaconda2 installed, fear not! You can still complete the exercises in this book, but you will have to create a new Python 3 environment. Check the tip box, below, for instruction on doing just that. 

```{block, type='rmdtip'}
Whether you are running Anaconda2 or Anaconda3, or one of the [Miniconda](https://conda.io/miniconda.html) variants, we recommend you create a new conda environment for this manual. You can accomplish this by writing the following commands from the base conda environment (i.e from the Anaconda Prompt on Windows or after running `conda activate` from a terminal on MacOS or Linux). 

    conda create -n "man_ccia" "python>=3.7.1" matplotlib netCDF4 pandas "seaborn>=0.9.0"

This will create a new environment, named "man_ccia", which will contain all of the packages that you will need to complete the exercises contained in this manual, including Python 3.7.1 or higher. If you plan to use Jupyter Notebook, your new environment won't be immediately available, however, you can install a "kernel" for your new environment by issuing the following commands: 

    conda activate man_ccia
    conda install ipykernel
    python -m ipykernel install --user --name="man_ccia" --display-name="man_ccia"

This command will create a simple JSON file, that tells Jupyter where to look for the Python executable and the packages that are contained in your "man_ccia" environment. Once you have run those commands and re-launched Jupyter Notebook, your "man_ccia" environment should be available under the "New" file creation menu and the "Kernel" options in any running Jupyter Notebook.
```

## Shell Commands

In addition to Python, we will be using two shell utilities, namely `bash` and `wget`. The following sections will help you to install these two pieces of software 

### Installing on Windows

#### Option 1: The Windows Linux Subsystem

If you are running a recent version of Windows 10 (build 16215 or later), you may wish to install the [Windows Linux Subsystem](https://docs.microsoft.com/en-us/windows/wsl/install-win10). To install Linux on Windows, find PowerShell in your start menu, and run it with administrator privileges. When the shell opens, run:

```
Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux
```

Once you have enabled the Windows Linux Subsystem, restart your machine, and install your Linux distribution of choice from the Windows Store, for example, [Ubuntu](https://www.microsoft.com/en-ca/p/ubuntu/9nblggh4msv6). When the install has completed, click "Launch" and choose a username for your Linux user account when prompted. 

The Linux distribution that you install should include `bash` and `wget`. Refer to the "Installing on Linux" (Section \@ref(installing-on-linux)), below, to confirm. 

#### Option 2: Via Cygwyn

If you are running an earlier version of Windows, you should use [Cygwin](https://cygwin.com/), a collection of open source tools that implement a small subset of Linux functionality on Windows.

You can install Cygwin directly from the Cygwin website, or via the Chocolatey package manager. To install directly, follow these steps:

1. Download and run the latest installer from the [Cygwin download page](https://cygwin.com/install.html)
2. When prompted, set the local package repository to somewhere where you don't mind a bit of clutter.
3. When given the option to install more packages, search for wget.
4. Click the "wget" entry that appears under "Internet", and ensure that the "bin" box is selected

If you prefer to install via Chocolatey, find the `cmd.exe` command on your start menu, and run that program as an administration. Enter the following commands (one at a time) to install Chocolatey, Cygwin, and wget. 

```
# Install Chocolately
@"%SystemRoot%\System32\WindowsPowerShell\v1.0\powershell.exe" -NoProfile -InputFormat None -ExecutionPolicy Bypass -Command "iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))" && SET "PATH=%PATH%;%ALLUSERSPROFILE%\chocolatey\bin"
```

Now open an instance of Windows Powershell with administrator privileges and run:

```
choco install cygwin cyg-get
cyg-get install wget
```

### Installing on MacOS

The MacOS Terminal app on modern versions of MacOS actually uses bash under the hood, so you are only likely to be missing wget. We will install wget on MacOS using the Homebrew Package Manager.

First, run the following code to install Homebrew
```{bash, eval = FALSE}
/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
```

Next, install wget using the newly installed `brew` command: 
```{bash, eval = FALSE}
brew install wget
```

If you prefer to install wget manually, you can download the latest version of the source code from the [GNU website](http://ftp.gnu.org/pub/gnu/wget/). Extract the archive, and run the following commands in the Terminal app;

```{bash, eval = FALSE}
./configure 
make
sudo make install
```

### Installing on Linux {#installing-on-linux}

If you are running Linux, you almost certainly already have both of these utilities. You can check for the presence of these executable files by opening a shell and typing:

```{bash}
which bash
```

```{bash}
which wget
```

If either of those commands says `no <command> in (/usr/local/sbin:/usr/local/bin:/usr/bin)`, then you will need to install. Installing programs varies widely by distribution, so refer to your distribution's package manager to find the `wget` and `bash` packages. 

On Ubuntu, for instance, you could run:
```{bash, eval = FALSE}
sudo apt-get update
sudo apt-get install wget
```

## Optional: Installing R

Many people consider R and Python to be mutually exclusive: you either use one, or the other. While it is true that there are many things that you can do in either of the two languages, each has its own idiosyncrasies. R was developed as a statistical programming language, and many of the methods that we will use in this course have been implemented efficiently in R. Indeed, _Conjuntool_, which we will use extensively in the Labs in this manual is written in R Shiny. The instructions below will help you to install R on your system. 

### Option 1: Installing via Anaconda

If you already have an Anaconda environment set up, and wish to install R, you can do this easily via Anaconda. To create a new Anaconda environment, and install everything you'll need to work in R, run the following command.

```{bash, eval = FALSE}
conda create -n r35 r-base r-essentials
```

If you want to use R from within Python, you could add R to an existing environment instead. As an example: 

```{bash, eval = FALSE}
conda install -n man_ccia r-base r-essentials rpy2
```

Or alternatively, add Python to the newly created R environment.

```{bash, eval = FALSE}
conda install -n r35 pandas python rpy2
```

### Option 2: 

If you would like to install R directly, follow the install instructions from [CRAN](https://cloud.r-project.org/). 

Once you have R installed, you will probably want to add the **IRkernel** so that you can use R within Jupyter Notebook. To do so, open R, and run the following commands: 

```{r, eval = FALSE}
install.packages(c('repr', 'IRdisplay', 'evaluate', 'crayon', 'pbdZMQ', 'devtools', 'uuid', 'digest'), repos = "https://cloud.r-project.org/")
devtools::install_github('IRkernel/IRkernel')
IRkernel::installspec()
```

### Getting the **canadaHCDx** package

You will have the option to complete Lab 1 using either shell commands, or an R package within Python. If you want to use the R package, you will have to install it. This is relatively simple. 

I have created a conda package for **canadaHCDx**, called **r-canadahcdx**. You can install this package from my personal Anaconda "channel" using the commands, below. 

```{bash, eval = FALSE}
conda config --prepend channels conda-forge # use conda-forge packages
conda config --append channels ConorIA # use my channel as a last resort
conda install -n <name of existing environment> r-canadahcdx
```

If you installed R directly (or if the above packages fail), you can install the package directly in R via **devtools**, which we installed when we installed **IRkernel**.

```{r, eval = FALSE}
devtools::install_git("https://gitlab.com/ConorIA/canadaHCDx")
devtools::install_github("ConorIA/canadaHCD@patched")
```
